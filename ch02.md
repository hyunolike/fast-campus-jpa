## Jpa Repository Interface ìƒì„¸
> â­ ì˜¤í”ˆì†ŒìŠ¤ ìì£¼ ë³´ì!!
- ì—¬ê¸°ì„œ ìë°” ê°ì²´ê°„ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°í•œë‹¤ê³  í–ˆëŠ”ë° ìë°” ê°ì²´ëŠ” ì—”í‹°í‹°í•˜ëŠ”ê±°ì•¼

## ìˆœì„œ
1. ì—”í‹°í‹°( __ìë°” ê°ì²´__ )
2. ë ˆí¬ì§€í† ë¦¬ - `CrudRepository` ì— ë§ì´ ì§€ì •?? ì œì¼ ìƒìœ„ í´ë˜ìŠ¤!
  - `findAll()`: ì¼ë°˜ì ìœ¼ë¡œ ì„±ëŠ¥ ì´ìŠˆë•Œë¬¸ì— ì‚¬ìš© x 
  - h2 ë””ë¹„ >> ë°ì´í„° ìœ ì§€ë˜ì§€x í…ŒìŠ¤íŠ¸ ì™„ë£Œì‹œì  ëª¨ë‘ ì‚¬ë¼ì§
  - ![image](https://user-images.githubusercontent.com/61215550/156967286-c73a822f-48d1-4b30-8c7e-239c9a4fb63d.png)
  - ë ˆí¬ì§€í† ë¦¬ ê±°ì˜ë‹¤ ì¡°íšŒ ê´€ë ¨ëœ ê±°ì•¼
  - `data.sql`: jpaê°€ ë¡œë”©í•  ë•Œ í•œë²ˆ ì‹¤í–‰ì‹œì¼œì¤˜!! âœ” 
  - `flush()` : ë””ë¹„ ë°˜ì˜ì‹œì  ì¡°ì ˆ
  - â­ `í˜ì´ì§€ ì²˜ë¦¬` (jpaë¡œ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬ ê°€ëŠ¥)
  ```java
  @Test
  void í˜ì´ì§•(){
      ìœ ì €_ìƒì„±();
      Page<User> users = userRepository.findAll(PageRequest.of(1, 3));
      System.out.println(users);
      System.out.println(users.getTotalElements());
      System.out.println(users.getTotalPages());
      System.out.println(users.getNumberOfElements());
      System.out.println(users.getSort());
      System.out.println(users.getSize());
      users.getContent().forEach(System.out::println);
  }
  ```
  - ğŸ‘» `QueryByExample` >> ì¼ë°˜ì ìœ¼ë¡œ __Querydsl__ !!
  ```java
    @Test
  void QueryByExample(){
      ìœ ì €_ìƒì„±();
//        ExampleMatcher matcher = ExampleMatcher.matching()
//                .withIgnorePaths("name")
//                .withMatcher("email", endsWith());

      Example<User> example = Example.of(new User("hyunho1", "hyunho@gmail.com1"));
      userRepository.findAll(example).forEach(System.out::println);
  }
  ```
  - ![image](https://user-images.githubusercontent.com/61215550/156972526-37becc8a-c7b9-44ed-84f6-8d33d60d8031.png)


```java
@NoRepositoryBean
public interface CrudRepository<T, ID> extends Repository<T, ID> {
    <S extends T> S save(S entity);

    <S extends T> Iterable<S> saveAll(Iterable<S> entities);

    Optional<T> findById(ID id);

    boolean existsById(ID id);

    Iterable<T> findAll();

    Iterable<T> findAllById(Iterable<ID> ids);

    long count();

    void deleteById(ID id);

    void delete(T entity);

    void deleteAllById(Iterable<? extends ID> ids);

    void deleteAll(Iterable<? extends T> entities);

    void deleteAll();
}
```
4. api í…ŒìŠ¤íŠ¸
```yml
spring:
  jpa:
    show-sql: true âœ” ì¿¼ë¦¬ ë³´ì—¬ì£¼ê¸°
    properties:
      hibernate:
        format_sql: true âœ” ì¢€ ë” ì´ì˜ê²Œ ì •ë ¬!! ì¿¼ë¦¬
```
`í…ŒìŠ¤íŠ¸ ì½”ë“œ`
```java
@Test
void CRUD(){
    ìœ ì €_ìƒì„±();
    userRepository.findAll().forEach(System.out::println);
}

@Test
void ì—­ìˆœì •ë ¬(){
    ìœ ì €_ìƒì„±();
    List<User> users = userRepository.findAll(Sort.by(Sort.Direction.DESC, "name"));
}

@Test
void ì„ íƒí›„_ëª¨ë‘ì¶œë ¥(){
    ìœ ì €_ìƒì„±();
    List<User> users = userRepository.findAllById(Lists.newArrayList(1L, 3L, 4L));
}

void ìœ ì €_ìƒì„±(){
    IntStream.rangeClosed(1, 30).forEach(i -> {
        User user = User.builder()
                .email("hyunho@gmail.com" + i)
                .name("hyunho" + i)
                .createdAt(LocalDateTime.now())
                .updatedAt(LocalDateTime.now())
                .build();
        userRepository.save(user);
    });
}

@Test
void ì„ íƒí›„_ì•„ë‹ˆë©´_ë„ì²˜ë¦¬(){
    ìœ ì €_ìƒì„±();
    User user = userRepository.findById(100L).orElse(null);
    System.out.println(user);
}

@Test
void flushí…ŒìŠ¤íŠ¸(){
    ìœ ì €_ìƒì„±();
    userRepository.flush();
    userRepository.findAll().forEach(System.out::println);
}

@Test
void ì¹´ìš´íŠ¸(){
    ìœ ì €_ìƒì„±();
    long count = userRepository.count();
    System.out.println(count);
}

@Test
void ì¡´ì¬í•˜ëŠ”ì§€(){
    ìœ ì €_ìƒì„±();
    boolean exists = userRepository.existsById(1L);
    System.out.println(exists);
}

@Test
void ì‚­ì œí•˜ê¸°(){
    ìœ ì €_ìƒì„±();
    userRepository.delete(userRepository.findById(1L).orElseThrow(RuntimeException::new));
}

âœ” deleteAll() // ëª¨ë‘ ë‹¤ ì§€ìš°ì >> ì„±ëŠ¥ ì´ìŠˆ!! ã… ,ã…  ì¿¼ë¦¬ ìƒìœ¼ë¡œ select >> ê°ê°ì„ ì‹¤í–‰í•˜ë‹ˆê¹Œ!! 
ì´ë¥¼ í•´ê²°ê³ ì deleteInBatch()!! ğŸ˜
```

![image](https://user-images.githubusercontent.com/61215550/156969159-635a85d1-6520-4228-af86-cfc4d9b691ad.png)

### ì‹¤ìŠµ
- í…ŒìŠ¤íŠ¸ì— ë¦¬ì†ŒìŠ¤ ë§Œë“¤ê¸°: ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ > ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸° ë‚˜ì˜´!!

### ì°¸ê³ 
- `@SpringBootTest`: Spring Context í™œìš©í•´ í…ŒìŠ¤íŠ¸ ì§„í–‰í•˜ê² ë‹¤ëŠ” ê±°

